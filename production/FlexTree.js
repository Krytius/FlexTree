/**
 * FlexTree
 * @version: 0.0.1
 * @author: Elvis Ferreira Coelho (http://elviscoelho.net)
 * Date criation: 01/04/2014
 */
var Tree=function(a){var b,c,d,e,f,g,h=new TreeCreate,i=new TreeEvents,j=new TreeFilter,k=document.getElementById(a),l={},m={},n=function(){return l},o=function(a){b=a},p=function(){return b},q=function(a){c=a},r=function(){return c},s=function(a){d=a},t=function(){return d},u=function(a){e=a},v=function(){return e},w=function(a){f=a},x=function(){return f},y=function(a){g=a},z=function(){return g},A=function(){return m},B=function(a){m=a},C=function(){return k},D=function(a,b){b&&(a=E(a,b)),l=a,G()},E=function(a,b){var c=[];switch(b){case"object":for(var d in a){var e;void 0===a[d].filho.length&&(e=F(a[d].filho),e.length>0&&(a[d].filho=e)),c.push(a[d])}}return c},F=function(a){var b=[];for(var c in a){var d;a[c].filho&&void 0===a[c].filho.length&&(d=F(a[c].filho),d.length>0&&(a[c].filho=d)),b.push(a[c])}return b},G=function(){if(k.className="mw-flextreeview",m={width:k.offsetWidth,height:k.offsetHeight},H(),h.load(C()),b){var a=I();if(g){var c=j.createFilter();a.appendChild(c)}k.appendChild(a)}var d=J();k.appendChild(d);for(var e=document.querySelectorAll("#mw-content-tree").length,i=0;e>i;i++)document.querySelectorAll("#mw-content-tree")[i].style.width=h.tamanhoContent()+"px";if(f){var l=K();k.appendChild(l)}},H=function(){h.init(Q),i.init(Q),j.init(Q)},I=function(){var a=L("div");if(a.className="mw-title",c){var d=L("i");d.className="icon",d.style.backgroundImage="url("+c+")",a.appendChild(d)}var e=L("div");return e.className="text",e.innerHTML=b,a.appendChild(e),a},J=function(){var a=L("div");a.className="mw-tree-view",a.style.height=h.calculoElementos()+"px";var b=h.createTree(l,function(){setTimeout(function(){h.remove(C())},1e3)});return a.appendChild(b),a},K=function(){var a=L("div");a.className="mw-tree-buttons";for(var b=f.length,c=b-1;c>=0;c--){var d=h.createButton(f[c]);a.appendChild(d)}return a},L=function(a){return document.createElement(a)},M=function(a){var b=document.querySelectorAll(a);return b.length<2?b[0]:b},N=function(a,b){b&&(b.className+=a)},O=function(a,b){b&&(b.className=b.className.replace(a,""))},P=function(a,b,c){c&&(c.className=c.className.replace(a,b))},Q={treeCreate:h,treeEvents:i,treeFilter:j,object:l,init:D,refresh:h.refreshTree,getElement:C,getObject:n,getTitle:p,setTitle:o,getIcon:r,setIcon:q,setColapse:s,getColapse:t,setCheck:u,getCheck:v,setButtons:w,getButtons:x,setFilter:y,getFilter:z,getDimension:A,setDimension:B,getSelected:i.getSelected,create:L,selector:M,addClass:N,removeClass:O,replaceClass:P,element:k,setMonitorEvent:i.setMonitorEvents};return Q},TreeCreate=function(){var a={},b=0,c=function(b){a=b},d=function(){return b},e=function(a,b,c){c?c+=1:c=1;for(var d=a.length,f=0;d>f;f++)if(a[f].id===b)return c;for(var g,f=0;d>f;f++){var h=a[f].filho?1:0;if(h&&(g=e(a[f].filho,b,c)),g)return g}},f=function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].id===b&&a[d].filho)return a[d].filho;for(var e,d=0;c>d;d++){var g=a[d].filho?1:0;if(g&&(e=f(a[d].filho,b)),e)return e}},g=function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].id===b)return a[d];for(var e,d=0;c>d;d++){var f=a[d].filho?1:0;if(f&&(e=g(a[d].filho,b)),e)return e}},h=function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].id===b)return a[d];for(var e,d=0;c>d;d++){var f=a[d].filho?1:0;if(f&&(e=h(a[d].filho,b)),e)return e}},i=function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d].id===b&&a[d].filho)return a[d];for(var e,d=0;c>d;d++){var f=a[d].filho?1:0;if(f&&(e=i(a[d].filho,b)),e)return e}},j=function(c,d){var f=c.length,g=a.create("div");g.setAttribute("id","mw-content-tree");for(var h=0;f>h;h++){var i,l=e(a.getObject(),c[h].id);i=c[h].filho?c[h].filho.length>0?1:0:0;var n=a.create("div");n.className="mw-topic",n.setAttribute("data-id",c[h].id),n.setAttribute("group-id",c[h].idGroup);var o=a.create("div");o.className="mw-topic-recuo",o.style.width=m(l)+"px",n.appendChild(o);var p=a.create("div");p.style.clear="both";var q=a.create("div");if(q.style.clear="both",a.getCheck()||(n.onclick=a.treeEvents.openCloseGroup),i){var r=k();a.getCheck()&&(r.onclick=a.treeEvents.openCloseGroup),n.appendChild(r)}else{var s=a.create("i");s.className="recuoSeta",n.appendChild(s)}if(a.getCheck()){var t=a.create("div");if(c[h].check){t.className="checkActive";var u=a.treeEvents.getSelected();u.push(c[h].id),a.treeEvents.setSelected(u)}else t.className="checkInative";t.setAttribute("id","mw-check"),t.onclick=a.treeEvents.markDesmarkCheck,n.appendChild(t)}var v=a.create("div");if(v.className="mw-title-tree",v.innerHTML=c[h].nome,v.onclick=a.treeEvents.eventsTitle,n.appendChild(v),g.appendChild(n),g.appendChild(p),l>1&&(n.parentNode.setAttribute("data-id",c[h].id),n.parentNode.setAttribute("group-id",c[h].idGroup),n.parentNode.className="mw-group",n.parentNode.style.display=a.getColapse()?"block":"none"),i){var w=j(c[h].filho);g.appendChild(w)}g.appendChild(q);var x=m(l)+(i?20:0)+(a.getCheck()?20:0)+9*c[h].nome.length;x>b&&(b=x)}return d&&d(),g},k=function(){var b=a.create("i");return b.className=a.getColapse()?"arrowActive":"arrowInactive",b},l=function(b){var c=a.create("div");c.className="mw-button-custom",c.style.width=b.width?b.width+"px":o()+"px";var d=a.create("div");return d.innerHTML=b.name,d.style.backgroundImage="url("+b.icon+")",d.className="mw-text-button",d.style.width=b.width?b.width-20+"px":o()-20+"px",c.appendChild(d),c.onclick=function(){a.treeEvents.eventButton(this,b.eventReturn,b.callback)},c},m=function(a){var b=20*(a?a:0);return b},n=function(){var b=a.getTitle()?28:0,c=a.getButtons()?35:0,d=a.element.offsetHeight-b-c;return d},o=function(){var b=a.element.offsetWidth,c=b/a.getButtons().length,d=.2*b;return c>d&&(c=d),c},p=function(b){var c=a.create("div");c.style.width=a.getDimension().width+"px",c.style.height=a.getDimension().height+"px",a.addClass("mw-carregando",c);var d=a.create("div");d.style.top=a.getDimension().height/2-64+"px",d.style.left=a.getDimension().width/2-64+"px",a.addClass("mw-centralizado",d);for(var e=0;8>e;e++){var f=a.create("div");f.setAttribute("id","circ"+e),a.addClass("circulo",f),d.appendChild(f)}c.appendChild(d),b.appendChild(c)},q=function(b){var c=a.selector("#"+b.id+" .mw-carregando");b.removeChild(c)},r=function(b){var c=a.getElement();c.childNodes[1].innerHTML="",c.childNodes[1].appendChild(s(b,a.treeEvents.getSelected()));for(var e=a.selector("#mw-content-tree").length,f=0;e>f;f++)a.selector("#mw-content-tree")[f].style.width=d()+"px"},s=function(c,d){var f=c.length,g=a.create("div");g.setAttribute("id","mw-content-tree");for(var h=0;f>h;h++){c[h]=t(d,c[h]);var i,j=e(a.getObject(),c[h].id);i=c[h].filho?c[h].filho.length>0?1:0:0;var l=a.create("div");l.className="mw-topic",l.setAttribute("data-id",c[h].id),l.setAttribute("group-id",c[h].idGroup);var n=a.create("div");n.className="mw-topic-recuo",n.style.width=m(j)+"px",l.appendChild(n);var o=a.create("div");o.style.clear="both";var p=a.create("div");if(p.style.clear="both",a.getCheck()||(l.onclick=a.treeEvents.openCloseGroup),i){var q=k();a.getCheck()&&(q.onclick=a.treeEvents.openCloseGroup),l.appendChild(q)}else{var r=a.create("i");r.className="recuoSeta",l.appendChild(r)}if(a.getCheck()){var u=a.create("div");if(c[h].check){u.className="checkActive";var v=a.treeEvents.getSelected();v.push(c[h].id),a.treeEvents.setSelected(v)}else u.className="checkInative";u.setAttribute("id","mw-check"),u.onclick=a.treeEvents.markDesmarkCheck,l.appendChild(u)}var w=a.create("div");if(w.className="mw-title-tree",w.innerHTML=c[h].nome,w.onclick=a.treeEvents.eventsTitle,l.appendChild(w),g.appendChild(l),g.appendChild(o),j>1&&(l.parentNode.setAttribute("data-id",c[h].id),l.parentNode.setAttribute("group-id",c[h].idGroup),l.parentNode.className="mw-group",l.parentNode.style.display=a.getColapse()?"block":"none"),i){var x=s(c[h].filho,d);g.appendChild(x)}g.appendChild(p);var y=m(j)+(i?20:0)+(a.getCheck()?20:0)+9*c[h].nome.length;y>b&&(b=y)}return g},t=function(a,b){if(b.check=!1,a){for(var c=0;c<a.length;c++)if(b.id===a[c]){b.check=!0;break}if(b.filho)for(var d=0;d<b.filho.length;d++)b.filho[d]=t(a,b.filho[d])}return b},u={init:c,createTree:j,returnTreeDown:f,returnTreeUp:i,returnTreePosition:g,returnTreePositionDown:h,createButton:l,calculoElementos:n,tamanhoContent:d,load:p,remove:q,refreshTree:r};return u},TreeEvents=function(){var a,b={},c=[],d=function(a){b=a},e=function(a){c=a},f=function(){return c},g=function(){var a,c;"arrow"===this.className.substr(0,5)?(a=this.parentNode,c=this):(a=this,c=this.childNodes[this.childNodes.length-1]);var d=a.getAttribute("data-id"),e=b.selector('.mw-group[group-id="'+d+'"]');"block"===e.style.display?(e.style.display="none",b.replaceClass("arrowActive","arrowInactive",c)):(e.style.display="block",b.replaceClass("arrowInactive","arrowActive",c))},h=function(){var a;a="check"===this.className.substr(0,5)?this:this.parentNode.childNodes[1],j(a)},i=function(){var a=this.parentNode.getAttribute("data-id");b.getCheck()&&j(b.selector('.mw-topic[data-id="'+a+'"] #mw-check'))},j=function(d){var e=d.parentNode.getAttribute("data-id"),f=d.parentNode.getAttribute("group-id"),g=!1;"checkMediate"===d.className?(g=!0,b.replaceClass("checkMediate","checkActive",d),m(e)):"checkActive"===d.className?(g=!1,b.replaceClass("checkActive","checkInative",d),l(e)):(g=!0,b.replaceClass("checkInative","checkActive",d),m(e));var h=b.treeCreate.returnTreeDown(b.getObject(),e);h&&k(h,g),n(f,b.getObject()),a&&a(e,g,c,q(f,e))},k=function(a,c){for(var d=a.length,e=0;d>e;e++){var f=b.selector('.mw-topic[data-id="'+a[e].id+'"][group-id="'+a[e].idGroup+'"] #mw-check');c?(b.replaceClass("checkInative","checkActive",f),m(a[e].id)):(b.replaceClass("checkActive","checkInative",f),l(a[e].id)),a[e].filho&&k(a[e].filho,c)}},l=function(a){if(c.length>0){var b=c.indexOf(a);c.splice(b,1)}},m=function(a){var b=c.indexOf(a);-1===b&&c.push(a)},n=function(a,c){var d=b.treeCreate.returnTreeUp(c,a);if(d){for(var e=d.filho.length,f=b.selector('#mw-content-tree[group-id="'+d.id+'"] div.mw-topic div#mw-check'),g=0,h=0;e>h;h++)f&&(f.length||(f=[f]),"checkActive"===f[h].className&&g++);if(b.selector('.mw-topic[data-id="'+d.id+'"] #mw-check')){var i=b.selector('.mw-topic[data-id="'+d.id+'"] #mw-check');i.className=g===e?"checkActive":0===g?"checkInative":"checkMediate"}}},o=function(a,b,d){switch(b){case"objectChecked":d(c)}},p=function(b,c){switch(b){case"onCheck":a=c}},q=function(a,c){var d=[],e=b.treeCreate.returnTreeUp(b.getObject(),a);for(d.push(b.treeCreate.returnTreePosition(b.getObject(),c));e;)d.push(e),e=b.treeCreate.returnTreeUp(b.getObject(),e.idGroup);return d},r={init:d,openCloseGroup:g,markDesmarkCheck:h,eventsTitle:i,eventButton:o,setSelected:e,getSelected:f,setMonitorEvents:p};return r},TreeFilter=function(){var a={},b=[],c=function(b){a=b},d=function(){b=[],e(this.value.toLowerCase(),a.getObject(),f)},e=function(a,c,d){for(var f=c.length,g=0;f>g;g++)-1===c[g].nome.toLowerCase().search(a)?c[g].filho&&e(a,c[g].filho):b.push(c[g].id);d&&d(b)},f=function(b){for(var c=[],d=0;d<b.length;d++)c.push(a.treeCreate.returnTreePositionDown(a.getObject(),b[d]));a.refresh(c)},g=function(){var b=.4*a.getDimension().width,c=a.create("div");c.className="mw-filter",c.style.width=b+"px";var e=a.create("div");e.className="mw-search",e.style.width="20px";var f=a.create("input");return f.className="mw-search-input",f.style.width=b-25+"px",f.onkeyup=d,c.appendChild(f),c.appendChild(e),c},h={init:c,createFilter:g};return h};